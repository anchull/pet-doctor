<div class="h-screen bg-black relative flex flex-col">
    <!-- Camera Feed -->
    <div class="relative flex-1 overflow-hidden">
        <video id="camera-feed" class="absolute w-full h-full object-cover" autoplay playsinline muted></video>

        <!-- Overlay Guide -->
        <div class="absolute inset-0 z-10 flex flex-col items-center justify-center pointer-events-none">
            <div class="w-64 h-96 border-4 border-white/50 rounded-3xl relative">
                <div
                    class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-primary -mt-1 -ml-1 rounded-tl-xl">
                </div>
                <div
                    class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-primary -mt-1 -mr-1 rounded-tr-xl">
                </div>
                <div
                    class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-primary -mb-1 -ml-1 rounded-bl-xl">
                </div>
                <div
                    class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-primary -mb-1 -mr-1 rounded-br-xl">
                </div>

                <!-- Strip Guide -->
                <div
                    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 bg-yellow-500/50 h-64 rounded-full">
                </div>
            </div>
            <p class="mt-8 text-white font-bold bg-black/50 px-4 py-2 rounded-full backdrop-blur-md">
                검사지 색상표를 가이드에 맞춰주세요
            </p>
        </div>
    </div>

    <!-- Controls -->
    <div class="h-44 bg-black/80 flex items-center justify-center gap-8 pb-safe mb-20 z-20">
        <button class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z">
                </path>
            </svg>
        </button>

        <button id="capture-btn"
            class="w-20 h-20 rounded-full bg-white border-4 border-gray-300 flex items-center justify-center group active:scale-95 transition-transform">
            <div class="w-16 h-16 rounded-full border-2 border-black"></div>
        </button>

        <button class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                </path>
            </svg>
        </button>
    </div>
</div>

<script>
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });
            const video = document.getElementById('camera-feed');
            video.srcObject = stream;
        } catch (err) {
            console.error("Camera error:", err);
            alert("카메라 권한이 필요합니다.");
        }
    }

    document.getElementById('capture-btn').addEventListener('click', () => {
        // Show loading state (Optional)
        const btn = document.getElementById('capture-btn');
        btn.classList.add('scale-90', 'opacity-50');

        // Create a hidden form and submit it to trigger the analysis post
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/scan/analyze';
        document.body.appendChild(form);
        form.submit();
    });

    // Start on load (if Turbo handles it)
    startCamera();

    // Turbo specific: ensure camera stops/starts on navigation
    // (Simplified for prototype)
</script>